<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>管理者ダッシュボード</title>
    <meta name="theme-color" content="#4f46e5">

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Noto+Sans+JP:wght@400;500;700&display=swap"
        rel="stylesheet">

    <!-- Icons -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet">

    <link rel="stylesheet" href="style.css">
</head>

<body>

    <!-- Loading Overlay -->
    <div id="loading-overlay" class="hidden">
        <div class="spinner"></div>
        <p>Loading...</p>
    </div>

    <!-- Toast Notification -->
    <div id="toast" class="toast hidden">
        <span id="toast-message">保存しました</span>
    </div>

    <!-- Admin Dashboard View -->
    <section id="view-admin" class="view">
        <header class="app-header">
            <div class="header-left">
                <a href="index.html" class="icon-btn header-back-link">
                    <span class="material-icons-round">arrow_back</span>
                </a>
                <div class="header-info">
                    <h2>管理者ダッシュボード</h2>
                    <span id="admin-date-display">2026-02-14</span>
                </div>
            </div>
            <div class="header-right">
                <input type="date" id="admin-dashboard-date" class="date-picker-sm">
            </div>
        </header>

        <div class="tabs">
            <button class="tab active" data-admin-tab="status">運行状況</button>
            <button class="tab" data-admin-tab="edit">予定編集</button>
            <button class="tab" data-admin-tab="master">マスタ管理</button>
        </div>

        <main class="content-scroll">
            <!-- Tab: Status -->
            <div id="admin-tab-status" class="admin-tab-content">
                <div id="course-status-list" class="status-list">
                    <!-- Progress bars injected here -->
                </div>
            </div>

            <!-- Tab: Edit -->
            <div id="admin-tab-edit" class="admin-tab-content hidden">
                <div class="card admin-card">
                    <h3>予定の編集 (一括モード)</h3>

                    <!-- 1. Select Course -->
                    <div class="form-group">
                        <label>コース選択</label>
                        <select id="edit-course-select" class="input-lg"></select>
                    </div>

                    <!-- 2. Import Template (Optional) -->
                    <div class="template-import-area">
                        <label class="template-import-label">テンプレートから読み込み (上書き)</label>
                        <div class="template-import-controls">
                            <select id="edit-template-select" class="input-lg template-import-select"></select>
                            <button id="btn-load-template" class="btn-secondary admin-btn-inline">展開</button>
                        </div>
                    </div>

                    <!-- 3. Editor Table -->
                    <div id="editor-container" class="hidden">
                        <div class="editor-toolbar">
                            <span id="editor-status-text" class="editor-hint">変更内容は「保存」するまで反映されません</span>
                            <button id="btn-add-row" class="btn-text admin-btn-quiet">+ 利用者追加</button>
                        </div>

                        <div id="editor-summary" class="editor-summary"></div>

                        <div class="editor-filter-bar">
                            <select id="edit-filter-type" class="input-lg">
                                <option value="">種別: すべて</option>
                                <option value="迎え">迎えのみ</option>
                                <option value="送り">送りのみ</option>
                            </select>
                            <input type="search" id="edit-filter-user" class="input-lg" placeholder="利用者名で検索">
                            <label class="editor-filter-checkbox">
                                <input type="checkbox" id="edit-filter-unassigned-vehicle">
                                車両未設定のみ
                            </label>
                        </div>

                        <div class="table-responsive">
                            <table class="editor-table">
                                <thead>
                                    <tr>
                                        <!-- <th>順</th> -->
                                        <th>時間</th>
                                        <th>種別</th>
                                        <th>利用者</th>
                                        <th>
                                            <div class="editor-vehicle-header">
                                                <span>車両</span>
                                                <button id="btn-copy-first-vehicle" type="button" class="btn-text admin-btn-quiet">1行目をコピー</button>
                                            </div>
                                        </th>
                                        <th>操作</th>
                                    </tr>
                                </thead>
                                <tbody id="editor-tbody">
                                    <!-- Rows -->
                                </tbody>
                            </table>
                        </div>

                        <div class="form-actions sticky-actions">
                            <button id="btn-save-bulk" class="btn-primary admin-btn-block admin-btn-primary-main">
                                この内容で保存する
                            </button>
                            <button id="btn-save-template" class="btn-secondary admin-btn-block admin-btn-subtle">
                                テンプレートとして保存
                            </button>
                        </div>
                    </div>

                    <div id="editor-empty" class="text-center editor-empty-state">
                        コースを選択してください
                    </div>
                </div>
            </div>

            <!-- Tab: Master -->
            <div id="admin-tab-master" class="admin-tab-content hidden">
                <div class="card admin-card">
                    <h3>マスタデータ管理</h3>

                    <div class="master-toolbar">
                        <select id="master-type-select" class="input-lg master-type-select">
                            <option value="user">利用者マスタ</option>
                            <option value="vehicle">車両マスタ</option>
                            <option value="course">コースマスタ</option>
                            <option value="facility">事業所マスタ</option>
                        </select>
                        <input type="search" id="master-search-input" class="input-lg master-search-input" placeholder="表示中マスタを検索">
                        <button id="btn-master-add" class="btn-secondary admin-btn-inline">+ 新規追加</button>
                        <button id="btn-master-save" class="btn-primary admin-btn-inline admin-btn-primary-main">保存する</button>
                    </div>

                    <div id="master-table-container" class="table-responsive scroll-panel">
                        <!-- Table injected here -->
                    </div>
                </div>
            </div>
        </main>
    </section>

    <!-- Edit Modal -->
    <div id="modal-edit" class="modal hidden">
        <div class="modal-content">
            <h3>予定の編集</h3>
            <div class="form-group">
                <label>利用者名</label>
                <div id="edit-user-name" class="editor-user-name"></div>
            </div>
            <div class="form-group">
                <label>予定時刻</label>
                <input type="time" id="edit-time" class="input-lg">
            </div>
            <div class="form-group">
                <label>配車車両</label>
                <select id="edit-vehicle-select" class="input-lg"></select>
            </div>
            <div class="form-actions">
                <button id="btn-cancel-edit" class="btn-secondary admin-btn-subtle">キャンセル</button>
                <button id="btn-save-edit" class="btn-primary admin-btn-primary-main">保存</button>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="common.js"></script>
    <script src="admin.js"></script>
</body>

</html>
