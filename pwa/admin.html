<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>管理者ダッシュボード</title>
    <meta name="theme-color" content="#4f46e5">

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Noto+Sans+JP:wght@400;500;700&display=swap"
        rel="stylesheet">

    <!-- Icons -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet">

    <link rel="stylesheet" href="style.css">
</head>

<body>

    <!-- Loading Overlay -->
    <div id="loading-overlay" class="hidden">
        <div class="spinner"></div>
        <p>Loading...</p>
    </div>

    <!-- Toast Notification -->
    <div id="toast" class="toast hidden">
        <span id="toast-message">保存しました</span>
    </div>

    <!-- Admin Dashboard View -->
    <section id="view-admin" class="view">
        <header class="app-header">
            <div class="header-left">
                <a href="index.html" class="icon-btn"
                    style="text-decoration:none; display:flex; align-items:center; color:inherit;">
                    <span class="material-icons-round">arrow_back</span>
                </a>
                <div class="header-info">
                    <h2>管理者ダッシュボード</h2>
                    <span id="admin-date-display">2026-02-14</span>
                </div>
            </div>
            <div class="header-right">
                <input type="date" id="admin-dashboard-date" class="date-picker-sm">
            </div>
        </header>

        <div class="tabs">
            <button class="tab active" data-admin-tab="status">運行状況</button>
            <button class="tab" data-admin-tab="edit">予定編集</button>
            <button class="tab" data-admin-tab="master">マスタ管理</button>
        </div>

        <main class="content-scroll">
            <!-- Tab: Status -->
            <div id="admin-tab-status" class="admin-tab-content">
                <div id="course-status-list" class="status-list">
                    <!-- Progress bars injected here -->
                </div>
            </div>

            <!-- Tab: Edit -->
            <div id="admin-tab-edit" class="admin-tab-content hidden">
                <div class="card admin-card">
                    <h3>予定の編集 (一括モード)</h3>

                    <div id="editor-summary-bar"
                        style="display:flex; gap:0.5rem; flex-wrap:wrap; margin-bottom:1rem; font-size:0.85rem;">
                        <span style="background:#eef2ff; color:#4338ca; padding:0.35rem 0.6rem; border-radius:999px;">総件数: <strong
                                id="summary-total">0</strong></span>
                        <span style="background:#fff7ed; color:#c2410c; padding:0.35rem 0.6rem; border-radius:999px;">未設定件数: <strong
                                id="summary-unset">0</strong></span>
                        <span style="background:#ecfdf3; color:#166534; padding:0.35rem 0.6rem; border-radius:999px;">変更件数: <strong
                                id="summary-changed">0</strong></span>
                    </div>

                    <!-- 1. Select Course -->
                    <div class="form-group">
                        <label>コース選択</label>
                        <select id="edit-course-select" class="input-lg"></select>
                    </div>

                    <!-- 2. Import Template (Optional) -->
                    <div class="template-import-area"
                        style="background:#f8f9fa; padding:1rem; border-radius:8px; margin-bottom:1rem;">
                        <label style="font-size:0.9rem; font-weight:bold; color:#666;">テンプレートから読み込み (上書き)</label>
                        <div style="display:flex; gap:0.5rem; margin-top:0.5rem;">
                            <select id="edit-template-select" class="input-lg" style="flex:1;"></select>
                            <button id="btn-load-template" class="btn-secondary">展開</button>
                        </div>
                    </div>

                    <!-- 3. Editor Table -->
                    <div id="editor-container" class="hidden">
                        <div class="editor-toolbar"
                            style="display:flex; justify-content:space-between; align-items:center; margin-bottom:0.5rem;">
                            <span id="editor-status-text"
                                style="font-size:0.9rem; color:#666;">変更内容は「保存」するまで反映されません</span>
                            <button id="btn-add-row" class="btn-text">+ 利用者追加</button>
                        </div>

                        <div class="editor-filter-bar"
                            style="display:grid; grid-template-columns: 120px minmax(140px,1fr) auto; gap:0.5rem; margin-bottom:0.75rem;">
                            <select id="edit-filter-type" class="input-lg" style="min-width:0;">
                                <option value="">全種別</option>
                                <option value="迎え">迎えのみ</option>
                                <option value="送り">送りのみ</option>
                            </select>
                            <input id="edit-filter-user" class="input-lg" type="search" placeholder="利用者名で絞り込み">
                            <label style="display:flex; align-items:center; gap:0.35rem; font-size:0.85rem; white-space:nowrap;">
                                <input id="edit-filter-no-vehicle" type="checkbox">
                                車両未設定のみ
                            </label>
                        </div>

                        <div class="table-responsive">
                            <table class="editor-table">
                                <thead>
                                    <tr>
                                        <!-- <th>順</th> -->
                                        <th>時間</th>
                                        <th>種別</th>
                                        <th>利用者</th>
                                        <th>車両</th>
                                        <th>操作</th>
                                    </tr>
                                </thead>
                                <tbody id="editor-tbody">
                                    <!-- Rows -->
                                </tbody>
                            </table>
                        </div>

                        <div class="form-actions" style="margin-top:1.5rem; position:sticky; bottom:1rem; z-index:10;">
                            <button id="btn-save-bulk" class="btn-primary"
                                style="width:100%; box-shadow: 0 4px 12px rgba(79, 70, 229, 0.3);">
                                この内容で保存する
                            </button>
                            <button id="btn-save-template" class="btn-secondary" style="width:100%; margin-top:0.5rem;">
                                テンプレートとして保存
                            </button>
                        </div>
                    </div>

                    <div id="editor-empty" class="text-center" style="padding:2rem; color:#999;">
                        コースを選択してください
                    </div>
                </div>
            </div>

            <!-- Tab: Master -->
            <div id="admin-tab-master" class="admin-tab-content hidden">
                <div class="card admin-card">
                    <h3>マスタデータ管理</h3>

                    <div class="master-toolbar"
                        style="display:flex; gap:1rem; align-items:center; margin-bottom:1rem; flex-wrap:wrap;">
                        <select id="master-type-select" class="input-lg" style="flex:1; min-width:150px;">
                            <option value="user">利用者マスタ</option>
                            <option value="vehicle">車両マスタ</option>
                            <option value="course">コースマスタ</option>
                            <option value="facility">事業所マスタ</option>
                        </select>
                        <button id="btn-master-add" class="btn-secondary">+ 新規追加</button>
                        <button id="btn-master-save" class="btn-primary">保存する</button>
                    </div>

                    <input id="master-search-input" type="search" class="input-lg" placeholder="表示中マスタを検索"
                        style="margin-bottom:0.75rem;">

                    <div id="master-table-container" class="table-responsive"
                        style="max-height: 500px; overflow-y:auto;">
                        <!-- Table injected here -->
                    </div>
                </div>
            </div>
        </main>
    </section>

    <!-- Edit Modal -->
    <div id="modal-edit" class="modal hidden">
        <div class="modal-content">
            <h3>予定の編集</h3>
            <div class="form-group">
                <label>利用者名</label>
                <div id="edit-user-name" style="font-weight:bold; padding:0.5rem 0;"></div>
            </div>
            <div class="form-group">
                <label>予定時刻</label>
                <input type="time" id="edit-time" class="input-lg">
            </div>
            <div class="form-group">
                <label>配車車両</label>
                <select id="edit-vehicle-select" class="input-lg"></select>
            </div>
            <div class="form-actions">
                <button id="btn-cancel-edit" class="btn-secondary">キャンセル</button>
                <button id="btn-save-edit" class="btn-primary">保存</button>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="common.js"></script>
    <script src="admin.js"></script>
</body>

</html>
